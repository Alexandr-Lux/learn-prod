(function(t){function e(e){for(var a,r,s=e[0],c=e[1],l=e[2],d=0,p=[];d<s.length;d++)r=s[d],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&p.push(i[r][0]),i[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);u&&u(e);while(p.length)p.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],a=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(a=!1)}a&&(o.splice(e--,1),t=r(r.s=n[0]))}return t}var a={},i={app:0},o=[];function r(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=a,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/learn-prod/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var u=c;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0025":function(t,e,n){},1114:function(t,e,n){"use strict";n("8398")},"30db":function(t,e,n){"use strict";n("0025")},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.mainLoading,expression:"mainLoading"}],staticClass:"map-wrapper"},[n("div",{staticClass:"map-wrapper__bar"},[n("Bar")],1),n("div",{staticClass:"map-wrapper__map"},[n("Map")],1)]),t.activeModalConfig?n("Modal"):t._e()],1)},o=[],r=n("5530"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"mapComp"},[n("div",{staticClass:"mapComp__map",attrs:{id:"mapContainer"}}),n("ul",{staticClass:"mapComp__btn-list"},t._l(t.layersOnMap,(function(e,a){return n("li",{key:e.id,staticClass:"mapComp__btn-item"},[n("div",{staticClass:"mapComp__btn-name"},[t._v(t._s(e.name))]),n("el-switch",{on:{change:function(e){return t.toggleLayer(a)}},model:{value:t.layersOnMap[a].isActive,callback:function(e){t.$set(t.layersOnMap[a],"isActive",e)},expression:"layersOnMap[index].isActive"}})],1)})),0)])},c=[],l=n("b85c"),u=n("1da1"),d=(n("96cf"),n("d3b7"),n("7db0"),n("a434"),n("4de4"),n("caad"),n("2532"),n("b0c0"),n("e192")),p=n.n(d),f={baseMap:{container:"mapContainer",style:"mapbox://styles/mapbox/streets-v11",center:[37.67,55.717],zoom:9.65}},m={markers:{id:"metro-stations-icon",type:"circle",source:"stations",name:"Маркеры",paint:{"circle-color":"#4264fb","circle-radius":4}},titles:{id:"metro-stations-name",type:"symbol",source:"stations",name:"Названия станций",layout:{"text-field":["get","name"],"text-size":12,"text-offset":[.5,0],"text-anchor":"left"},paint:{"text-color":"#555"}},lines:{id:"metro-lines",type:"line",source:"lines",name:"Линии",layout:{"line-cap":"round"},paint:{"line-blur":2,"line-width":4}}},h={stations:{id:"stations",type:"Point",url:"./data/stations.json"},lines:{id:"lines",type:"LineString",url:"./data/lines.json"}},b=(n("0481"),n("4069"),n("d81d"),function(t,e,n){switch(n){case"stations":return{type:"FeatureCollection",features:t.map((function(t){return t.stations.map((function(t){return{geometry:{type:e,coordinates:[t.lng,t.lat]},type:"Feature",properties:Object(r["a"])({},t)}}))})).flat()};case"lines":return{type:"FeatureCollection",features:t.map((function(t){return{geometry:{type:e,coordinates:t.coordinates.map((function(t){return[t[1],t[0]]}))},type:"Feature",properties:Object(r["a"])({},t)}}))}}}),g=(n("159b"),function(t){var e=["match",["get","hex_color"]];return t.features.forEach((function(t){e.push(t.properties.hex_color),e.push("#".concat(t.properties.hex_color))})),e.push("#f0f"),e}),v=n("2f62"),y={name:"BaseMap",data:function(){return{mapgl:null,sourcesOnMap:[],layersOnMap:[],accessToken:"pk.eyJ1IjoiYWxla3NhbmRybHVrcyIsImEiOiJja3k5cW11OHEwOHozMzJvMDQ3NmNkb3hzIn0.29DVVkWSchzT4Hh210QUBg"}},computed:Object(r["a"])({},Object(v["e"])({stations:function(t){return t.stations.data},lines:function(t){return t.lines.data},geostations:function(t){return t.stations.geojson},geolines:function(t){return t.lines.geojson},activeModalConfig:function(t){return t.activeModalConfig},searchText:function(t){return t.filterText},searchType:function(t){return t.whatToSearch}})),methods:Object(r["a"])(Object(r["a"])(Object(r["a"])({},Object(v["b"])(["fetchDataset","createModal"])),Object(v["d"])(["SET_GEOJSON","SET_ACTIVEMODAL"])),{},{addLayerToMap:function(t,e){var n=this;return Object(u["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!e||!e.url){a.next=4;break}return a.next=3,n.fetchDataset({url:e.url,id:e.id});case 3:n.SET_GEOJSON({data:b(n[e.id],e.type,e.id),id:e.id});case 4:e&&(n.sourcesOnMap.some((function(t){return t.id===e.id}))?n.sourcesOnMap.find((function(t){return t.id===e.id})).activeLayerIds.push(t.id):(n.sourcesOnMap.push({id:e.id,activeLayerIds:[t.id]}),n.mapgl.addSource(e.id,{type:"geojson",data:n["geo".concat(e.id)]}))),n.layersOnMap.some((function(e){return e.id===t.id}))||n.layersOnMap.push(Object(r["a"])({isActive:!0},t)),n.mapgl.addLayer(t),n.mapgl.on("click",t.id,(function(t){n.SET_ACTIVEMODAL({id:t.features[0].properties.id,type:e.id})})),n.mapgl.on("mouseenter",t.id,(function(){n.mapgl.getCanvas().style.cursor="pointer"})),n.mapgl.on("mouseleave",t.id,(function(){n.mapgl.getCanvas().style.cursor=""}));case 10:case"end":return a.stop()}}),a)})))()},toggleLayer:function(t){var e=this.layersOnMap[t],n=this.sourcesOnMap.find((function(t){return t.id===e.source}));e.isActive?n?(this.sourcesOnMap.find((function(t){return t.id===e.source})).activeLayerIds.push(e.id),this.addLayerToMap(e)):this.addLayerToMap(e,h[e.source]):(this.mapgl.removeLayer(e.id),n.activeLayerIds.splice(n.activeLayerIds.indexOf(e.id),1),0===n.activeLayerIds.length&&(this.mapgl.removeSource(n.id),this.SET_GEOJSON({data:null,id:n.id}),this.sourcesOnMap.splice(this.sourcesOnMap.indexOf(n),1)))}}),watch:{activeModalConfig:function(t){if(t){if("stations"===t.type){var e=this.stations.find((function(e){return e.stations.find((function(e){return e.id===t.id}))})).stations.find((function(e){return e.id===t.id}));this.mapgl.flyTo({center:[e.lng,e.lat],zoom:13}),this.mapgl.setPaintProperty("metro-stations-icon","circle-radius",["case",["==",["get","id"],t.id],8,4]),this.mapgl.setLayoutProperty("metro-stations-name","text-size",["case",["==",["get","id"],t.id],20,12])}else if("lines"===t.type){var n,a=this.geolines.features.find((function(e){return e.properties.id===t.id})).geometry.coordinates,i=new p.a.LngLatBounds(a[0],a[0]),o=Object(l["a"])(a);try{for(o.s();!(n=o.n()).done;){var r=n.value;i.extend(r)}}catch(s){o.e(s)}finally{o.f()}this.mapgl.fitBounds(i,{padding:50}),this.mapgl.setPaintProperty("metro-lines","line-width",["case",["==",["get","id"],t.id],10,4])}}else this.mapgl.setPaintProperty("metro-lines","line-width",4),this.mapgl.setPaintProperty("metro-stations-icon","circle-radius",4),this.mapgl.setLayoutProperty("metro-stations-name","text-size",12)},searchText:function(t){this.mapgl.getSource(this.searchType).setData({type:"FeatureCollection",features:this["geo".concat(this.searchType)].features.filter((function(e){return e.properties.name.toLowerCase().includes(t.toLowerCase())}))})}},mounted:function(){var t=this;p.a.accessToken=this.accessToken,this.mapgl=new p.a.Map(f.baseMap),this.mapgl.on("load",Object(u["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.addLayerToMap(m.markers,h.stations);case 2:return e.next=4,t.addLayerToMap(m.titles,h.stations);case 4:return e.next=6,t.addLayerToMap(m.lines,h.lines);case 6:t.mapgl.setPaintProperty("metro-lines","line-color",g(t.geolines)),t.layersOnMap.find((function(t){return"metro-lines"===t.id})).paint["line-color"]=g(t.geolines);case 8:case"end":return e.stop()}}),e)}))))}},_=y,O=(n("894b"),n("2877")),T=Object(O["a"])(_,s,c,!1,null,null,null),C=T.exports,x=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.stations?n("div",{staticClass:"barComp",attrs:{id:"barContainer"}},[n("el-radio-group",{on:{change:function(e){t.openLineId=""}},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[n("el-radio-button",{attrs:{label:"stations"}},[t._v("Станции")]),n("el-radio-button",{attrs:{label:"lines"}},[t._v("Линии")])],1),n("div",{staticClass:"barComp__body"},[n("div",{staticClass:"barComp__input"},[n("el-input",{staticClass:"barComp__input-item",attrs:{clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),n("ul",{staticClass:"barComp__lines-list"},t._l(t.sourceByTab(),(function(e){return n("li",{key:e.name,ref:"line",refInFor:!0,staticClass:"barComp__lines-item line"},[n("div",{class:["line__name",{borderBottom:"stations"===t.activeTab,borderLeft:"lines"===t.activeTab}],style:{"border-color":"#"+e.hex_color},on:{click:function(n){return t.linesHandler(e.id)}}},[t._v(" "+t._s(e.name)+" ")]),"stations"===t.activeTab?n("ul",{class:["line__stations-list",{opened:t.openLineId===e.id||t.searchText}]},t._l(e.stations,(function(e){return n("li",{key:e.id,staticClass:"line__stations-item",on:{click:function(n){return t.SET_ACTIVEMODAL({id:e.id,type:"stations"})}}},[t._v(t._s(e.name)+" ")])})),0):t._e()])})),0)])],1):t._e()},M=[],L={data:function(){return{openLineId:"",activeTab:"stations"}},computed:Object(r["a"])(Object(r["a"])(Object(r["a"])({},Object(v["e"])({stations:function(t){return t.stations.data},searchText:function(t){return t.filterText}})),Object(v["c"])(["filterStationsBySearch","filterLinesBySearch"])),{},{filterText:{get:function(){return this.searchText},set:function(t){this.FILTER_STATIONS({value:t,type:this.activeTab})}}}),methods:Object(r["a"])(Object(r["a"])({},Object(v["d"])(["FILTER_STATIONS","SET_ACTIVEMODAL"])),{},{linesHandler:function(t){switch(this.activeTab){case"stations":this.openLineId===t?this.openLineId="":this.openLineId=t;break;case"lines":this.SET_ACTIVEMODAL({id:t,type:"lines"})}},sourceByTab:function(){switch(this.activeTab){case"stations":return this.filterStationsBySearch;case"lines":return this.filterLinesBySearch}}})},j=L,w=(n("1114"),Object(O["a"])(j,x,M,!1,null,null,null)),S=w.exports,E=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.modal?n("div",{staticClass:"modalComp"},[n("div",{staticClass:"modalComp__dialog"},[n("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{visible:null!==t.modal,width:"40%","before-close":t.closeModal,"element-loading-text":"wait for it...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.3)"}},[t.loading?t._e():n("div",[n("div",{staticClass:"modalComp__title",attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.modal.name))]),"stations"===t.activeModalConfig.type?n("div",{staticClass:"modalComp__text"},[t._v("Станция находится в районе "+t._s(t.modal.district)+", "+t._s(t.modal.admArea)+". На данный момент станция "+t._s(t.modal.status))]):n("div",{staticClass:"modalComp__text"},[t._v("Здесь может быть информация о линии")])])])],1)]):t._e()},I=[],A={data:function(){return{modal:null,loading:!0}},computed:Object(r["a"])({},Object(v["e"])({activeModalConfig:function(t){return t.activeModalConfig},stations:function(t){return t.stations.data},lines:function(t){return t.lines.data}})),methods:Object(r["a"])(Object(r["a"])({},Object(v["d"])(["SET_ACTIVEMODAL"])),{},{closeModal:function(){this.SET_ACTIVEMODAL(null),this.modal=null}}),mounted:function(){var t=this;switch(this.activeModalConfig.type){case"stations":this.modal=this.stations.find((function(e){return e.stations.find((function(e){return e.id===t.activeModalConfig.id}))})).stations.find((function(e){return e.id===t.activeModalConfig.id}));break;case"lines":this.modal=this.lines.find((function(e){return e.id===t.activeModalConfig.id}))}setTimeout((function(){t.loading=!1}),500)}},k=A,P=(n("30db"),Object(O["a"])(k,E,I,!1,null,null,null)),D=P.exports,B={name:"App",components:{Map:C,Bar:S,Modal:D},computed:Object(r["a"])({},Object(v["e"])({activeModalConfig:function(t){return t.activeModalConfig},mainLoading:function(t){return t.mainLoading}}))},N=B,R=(n("5c0b"),Object(O["a"])(N,i,o,!1,null,null,null)),V=R.exports;a["default"].use(v["a"]);var z=new v["a"].Store({state:{activeModalConfig:null,whatToSearch:"",mainLoading:!0,stations:{data:null,geojson:null},lines:{data:null,geojson:null},filterText:""},getters:{filterStationsBySearch:function(t){return t.stations.data.filter((function(e){return 0!==e.stations.filter((function(e){return-1!==e.name.toLowerCase().indexOf(t.filterText.toLowerCase())})).length})).map((function(e){return Object(r["a"])(Object(r["a"])({},e),{},{stations:e.stations.filter((function(e){return-1!==e.name.toLowerCase().indexOf(t.filterText.toLowerCase())}))})}))},filterLinesBySearch:function(t){return t.lines.data.filter((function(e){return e.name.toLowerCase().includes(t.filterText.toLowerCase())}))}},mutations:{SET_SOURCES_DATA:function(t,e){t[e.id].data=e.data,t.mainLoading=!1},SET_ACTIVEMODAL:function(t,e){t.activeModalConfig=e},FILTER_STATIONS:function(t,e){t.filterText=e.value,t.whatToSearch=e.type},SET_GEOJSON:function(t,e){t[e.id].geojson=e.data}},actions:{fetchDataset:function(t,e){return Object(u["a"])(regeneratorRuntime.mark((function n(){var a,i,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=t.commit,i=e.url,o=e.id,n.prev=2,n.next=5,fetch(i).then((function(t){return t.json()})).then((function(t){a("SET_SOURCES_DATA",{data:t,id:o})}));case 5:n.next=10;break;case 7:n.prev=7,n.t0=n["catch"](2),alert(n.t0);case 10:case"end":return n.stop()}}),n,null,[[2,7]])})))()}}}),F=n("5c96"),J=n.n(F),H=n("dccd"),$=n.n(H);n("0fae");a["default"].config.productionTip=!1,a["default"].use(J.a,{locale:$.a}),new a["default"]({store:z,render:function(t){return t(V)}}).$mount("#app")},"5c0b":function(t,e,n){"use strict";n("9c0c")},8398:function(t,e,n){},"894b":function(t,e,n){"use strict";n("a8f9")},"9c0c":function(t,e,n){},a8f9:function(t,e,n){}});
//# sourceMappingURL=app.7ff2d488.js.map